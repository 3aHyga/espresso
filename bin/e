#!/usr/bin/env ruby
require 'fileutils'

$:.unshift File.expand_path('../../lib', __FILE__)
require 'e'
require 'e-more/generator'

if $*.empty?
  Rack::Server.start
  exit 0 # exiting when server stopped/killed
end

operation = $*[0]
if operation =~ /\Ag/i
  generator  = EspressoGenerator.new(Dir.pwd)
  unit = operation.sub(/\Ag\W?/i, '')

  if unit =~ /\Ap/i
    generator.generate :project, $*[1], $*[2]
  else
    generator.in_app_folder?
    require generator.boot_file

    if unit =~ /\Ac/i
      generator.generate :controller, $*[1], $*[2]
    end

    if unit =~ /\Ar/i
      generator.generate :route, $*[1], $*[2], *$*[3..-1]
      puts %x["#{$0}" g:v #{$*[1]} #{$*[2]}]
    end

    if unit =~ /\Av/i
      generator.generate :view, $*[1], $*[2]
    end

    if unit =~ /\Am/i
      generator.generate :model, $*[1], $*[2]
    end
  end

  exit 0
end
